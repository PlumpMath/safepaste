#!/usr/bin/env bash

set -eu

dir="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

function usage
{
  echo "usage: $0 <about|donate> [<proj dir> <dest dir>]"
  exit 1
}

[ $# -eq 1 -o $# -eq 3 ] || usage

paste=$1
proj=${2:-$dir/..}
dest=${3:-$proj/paste}

# $1 => input file
# $2 => output file
# $3 => secret key
function encrypt
{
  openssl aes-256-cbc -pass pass:$3 -in "$1" -out "$2"
  touch -c -m -t 210012250000 "$2" # Christmas, year 2100
  echo "encrypted paste written to $2"
}

case "$paste" in
  'about')
    encrypt "$proj/src/paste/about" \
            "$dest/14e3c3ce" \
            "371864573d2a445868316521cc3cc374413f3eb04978281c964527cdc79a64bb"
    ;;
  'donate')
    encrypt "$proj/src/paste/about" \
            "$dest/f1a8f535" \
            "31bcdb56b77528a3c1b540bc460ed07d5b74fcf65eb91733bc4d10884e764caf"
    ;;
  *)
    usage
    ;;
esac
